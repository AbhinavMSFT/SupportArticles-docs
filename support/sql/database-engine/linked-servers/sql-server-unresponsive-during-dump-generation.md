---
title: Linked server query referencing LOB data type that encounters exceptions results in SQL Server dump generation
description: This article helps you to resolve an issue where SQL Server becomes unresponsive due to an assert dump where a linked server query is referencing a LOB data type and encounters an exception.
ms.date: 02/14/2024
ms.custom: sap:Database Engine
---

# SQL Server generates an assert dump when a linked server query using a LOB data type encounters an exception

This article helps you resolve an issue that might arise when SQL Server becomes unresponsive when a SQL Server dump is generated.

## Symptoms

Consider the following scenario:

- An assert dump is generated by SQL Server causing the SQL Server service to be unresponsive.
- In the SQL Server errorlog, you observe the assert expression `pilb->m_cRef == 0`. For more information on what asserts are and how to troubleshoot them, see [MSSQLSERVER_3624 - SQL Server](/sql/relational-databases/errors-events/mssqlserver-3624-database-engine-error).
  
   > 2023-03-14 06:12:44.83 spid54      * Location: memilb.cpp:1836
   > 2023-03-14 06:12:44.83 spid54      * Expression: pilb->m_cRef == 0

- SQL Server becomes unresponsive during the dump process.

## Cause

Following are some conditions that can affect when the SQL Server dump is being generated:

- A remote query is executed using the `EXEC AT` command. For example:

  ```sql
  DECLARE @test NVARCHAR(MAX) = N'ABC'
  EXEC ('SELECT * FROM Customers.dbo.CustomerInformation WHERE CustomerId = ?', @test) AT [YourRemoteServer];
  ```

- A large object (LOB) argument is passed to the query.
  For more information about a list of LOB data types, see [Data types (Transact-SQL) - SQL Server](/sql/t-sql/data-types/data-types-transact-sql).

In the previous example, the `NVARCHAR(MAX)` variable is passed as a query parameter. One of the underlying requests submitted to the linked server fails.

You can also reproduce the issue by running the following query:

```sql
DECLARE @test NVARCHAR(MAX) = N'msdb' 
EXEC ('---SELECT * FROM sys.databases where name = ?', @test) AT [<server>\<instance>]
```

Avoid by using nonblob (BLOB) data type in your database design or code:

```sql
DECLARE @test NVARCHAR(5) = N'msdb' 
EXEC ('---SELECT * FROM sys.databases where name = ?', @test) AT  [<server>\<instance>]
```

## Resolution

Microsoft is still investigating this issue to identify a long-term fix. Until then, you can try the following workaround:

Change all `LOB` (Large Object) data types to fixed length data types (for example, convert `NVARCHAR(MAX)` to `NVARCHAR(200))`) that the input data length supports.
